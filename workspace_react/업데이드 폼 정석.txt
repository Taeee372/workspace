import axios from 'axios';
import React, { useEffect, useState } from 'react'
import { useNavigate, useParams } from 'react-router-dom'
import BoardDetail from './BoardDetail';
import styles from './UpdateForm.module.css'

const UpdateForm = () => {

  //boardNum번의 기존 데이터 가져오기 위한 state
  const [detailData, setDetailData] = useState({});

  //제목과 내용 변경을 위한 state
  const [updateData, setUpdateData] = useState({
    'title' : '',
    'content' : ''
  });

  const nav = useNavigate();

  //url로 전달되는 글 번호
  const {boardNum} = useParams();
  // console.log(detailData.title);

  // detailData가 값이 바뀔 때만 실행 + 마운트 시에는 실행 x
  // 의존성 배열에 detailData를 넣으면 detailData값이 바뀌어서 리렌더링 될 때도 실행
  useEffect(() => {
    if(detailData.title !== undefined){ //마운트 시점이 아니라면
      setUpdateData({
        'title' : detailData.title,
        'content' : detailData.content
      })
    }
  }, [detailData])
  
  //마운트되면 기존 데이터 넣기
  useEffect(() => {
    axios.get(`/api/boards/${boardNum}`)
    .then(res => {
      // console.log(res.data.title)
      // console.log(res.data.content)
      setDetailData(res.data)
    })
    .catch(error => console.log(error));
  }, [])
    console.log(updateData)

  //수정할 내용을 입력할 때마다 저장
  const handleData = (e) => {
    setUpdateData({
      ...updateData,
      [e.target.name] : e.target.value
    })
  }

  //수정된 데이터 전달
  const putData = () => {
    axios.put(`/api/boards/${boardNum}`, updateData)
    .then(res => {
      alert('수정 완료')
      nav(`/boardDetail/${boardNum}`)
    })
    .catch(error => console.log(error));
  }
  
  // console.log(boardNum);

  return (
    <div className={styles.container}>
      <div className={styles.title_div}>
        <h3>게시글 수정 페이지</h3>
      </div>
      <div className={styles.table_div}>
        <table className={styles.detail_table}>
          <tbody>
            <tr>
              <td>작성일</td>
              <td>{detailData.createDate}</td>
              <td>작성자</td>
              <td>{detailData.writer}</td>
            </tr>
            <tr>
              <td>제목</td>
              <td colSpan={3}>
                <input type="text" name='title' value={updateData.title} onChange={e => handleData(e)}/>
                </td>
            </tr>
            <tr>
              <td>내용</td>
              <td colSpan={3}><textarea cols={50} rows={5} name='content' value={updateData.content} onChange={e => handleData(e)}></textarea></td>
            </tr>
          </tbody>
        </table>
      </div>
      <div className={styles.btn_div}>
        <button type='buttton' onClick={e => nav(-1)}>뒤로가기</button>
        <button type='buttton' onClick={e => putData()}>수정</button>
      </div>
    </div>
  )
}

export default UpdateForm